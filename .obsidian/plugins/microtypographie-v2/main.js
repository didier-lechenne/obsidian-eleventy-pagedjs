/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
Typography Fixers Plugin for Obsidian
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var P=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var re=(a,r)=>{for(var e in r)P(a,e,{get:r[e],enumerable:!0})},ie=(a,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of ee(r))!te.call(a,i)&&i!==e&&P(a,i,{get:()=>r[i],enumerable:!(t=J(r,i))||t.enumerable});return a};var se=a=>ie(P({},"__esModule",{value:!0}),a);var ne={};re(ne,{default:()=>L});module.exports=se(ne);var m=require("obsidian");var C=require("@codemirror/view"),Q=require("@codemirror/state"),H;function q(a){H=a;let r=C.Decoration.mark({class:"nonBreakingSpace"}),e=C.Decoration.mark({class:"thinSpace"}),t=C.Decoration.mark({class:"em-dash"}),i=C.Decoration.mark({class:"regularSpace"});return C.ViewPlugin.fromClass(class{constructor(n){this.decorations=this.buildDecorations(n)}update(n){(n.docChanged||n.viewportChanged)&&(this.decorations=this.buildDecorations(n.view))}buildDecorations(n){let l=new Q.RangeSetBuilder;if(H&&H.highlightEnabled)for(let{from:o,to:p}of n.visibleRanges){let u=n.state.doc.sliceString(o,p),g=o,d=!1,D=!1,f=!0;for(let b=0;b<u.length;b++){let x=u[b],E=g+b;if(f&&u.substr(b,3)==="---"){d=!d,b+=2,f=!1;continue}if(f&&u.substr(b,3)==="```"){D=!D,b+=2,f=!1;continue}x===`
`?f=!0:f&&x!==" "&&x!=="	"&&(f=!1),d||D||(x==="\xA0"&&l.add(E,E+1,r),x==="\u202F"&&l.add(E,E+1,e),x==="\u2014"&&l.add(E,E+1,t),x===" "&&l.add(E,E+1,i))}}return l.finish()}},{decorations:n=>n.decorations})}var U=require("obsidian");function G(a,r,e){let t=a.addStatusBarItem();return t.id="highlight-status-bar-button",t.addClass("mod-clickable"),(0,U.setIcon)(t,"pilcrow"),t.setAttribute("aria-label","Afficher/Masquer les caract\xE8res invisibles"),t.setAttribute("data-tooltip-position","top"),M(t,r),t.onClickEvent(()=>{e()}),t}function V(a,r,e){let t=document.createElement("button");t.id="highlight-tab-title-button",t.className="clickable-icon view-action",t.setAttribute("aria-label","Afficher/Masquer les caract\xE8res invisibles"),(0,U.setIcon)(t,"pilcrow"),K(t,r),t.addEventListener("click",n=>{n.preventDefault(),e()});let i=document.querySelector(".view-header-title-container");if(i){let n=i.nextElementSibling;n&&n.classList.contains("view-actions")&&n.prepend(t)}return t}function M(a,r){a&&(r?a.addClass("is-active"):a.removeClass("is-active"))}function K(a,r){a&&(r?a.addClass("is-active"):a.removeClass("is-active"))}function z(a){a&&a.remove()}function W(a){a&&a.remove()}var c=class{constructor(){this.enabled=!0;this.locale="fr-FR"}setSettings(r){this.settings=r}isGuillemetsEnabled(){var r,e;return(e=(r=this.settings)==null?void 0:r.guillemetsEnabled)!=null?e:!1}setLocale(r){this.locale=r}isLocaleCompatible(r){return r.some(e=>this.locale.startsWith(e))}isActive(){return this.enabled}applyRegexTransform(r,e,t){return r.replace(e,t)}applyMultipleTransforms(r,e){return e.reduce((t,i)=>typeof i.replacement=="string"?this.applyRegexTransform(t,i.pattern,i.replacement):this.applyRegexTransform(t,i.pattern,i.replacement),r)}isValidContext(r,e){let t=r.substring(Math.max(0,e-10),e),i=r.substring(e,Math.min(r.length,e+10));return!(t.includes("`")&&i.includes("`")||t.includes("[")&&i.includes("]"))}logCorrection(r,e){}};var s={NO_BREAK_THIN_SPACE:"\u202F",NO_BREAK_SPACE:"\xA0",NORMAL_SPACE:" ",ELLIPSIS:"\u2026",NDASH:"\u2013",MDASH:"\u2014",LDQUO:"\u201C",RDQUO:"\u201D",RSQUO:"\u2019",LAQUO:"\xAB",RAQUO:"\xBB",BDQUO:"\u201E",SHY:"\xC2\xAD",TIMES:"\xD7",DIVIDE:"\xF7",PLUS_MINUS:"\xB1",MINUS:"\u2212",TRADE:"\u2122",REG:"\xAE",COPY:"\xA9",PRIME:"\u2032",DOUBLE_PRIME:"\u2033",SECTION:"\xA7",PARAGRAPH:"\xB6",BULLET:"\u2022",ARROW_RIGHT:"\u2192",ARROW_LEFT:"\u2190",EURO:"\u20AC",POUND:"\xA3",YEN:"\xA5"},Z={MULTIPLE_SPACES:/\s{2,}/g,ELLIPSIS_DOTS:/\.{3,}/g,DOUBLE_DASH:/--/g,STRAIGHT_QUOTES:/"/g,STRAIGHT_APOSTROPHES:/(\w)'/g,MULTIPLY_X:/(\d+)\s*[xX]\s*(\d+)/g,MULTIPLY_STAR:/(\d+)\s*\*\s*(\d+)/g,TRADEMARK_TEXT:/\(tm\)/gi,REGISTERED_TEXT:/\(r\)/gi,COPYRIGHT_TEXT:/\(c\)/gi};var S=class extends c{constructor(){super(...arguments);this.id="Ellipsis";this.name="Points de suspension";this.description="Remplace ... par le caract\xE8re ellipse Unicode (\u2026)";this.category="punctuation";this.priority=1}fix(e){return this.applyRegexTransform(e,Z.ELLIPSIS_DOTS,s.ELLIPSIS)}handleKeyEvent(e,t){if(e.key==="."&&!e.ctrlKey&&!e.metaKey){let i=t.getCursor(),n=t.getLine(i.line);if(n.substring(0,i.ch).endsWith("..")){let o=n.substring(0,i.ch-2)+s.ELLIPSIS+n.substring(i.ch);return t.setLine(i.line,o),t.setCursor({line:i.line,ch:i.ch-1}),!0}}return!1}getExample(){return{before:"En fait... c'est compliqu\xE9...",after:`En fait${s.ELLIPSIS} c'est compliqu\xE9${s.ELLIPSIS}`}}};var T=class extends c{constructor(){super(...arguments);this.id="Dash";this.name="Tirets typographiques";this.description="Convertit -- en \u2014 et am\xE9liore les tirets entre nombres";this.category="punctuation";this.priority=2}fix(e){let t=[{pattern:/--/g,replacement:s.MDASH},{pattern:/(\d+)\s*-\s*(\d+)/g,replacement:`$1${s.NDASH}$2`},{pattern:/\s*—\s*/g,replacement:this.isLocaleCompatible(["fr"])?` ${s.MDASH} `:`${s.MDASH}`}];return this.applyMultipleTransforms(e,t)}handleKeyEvent(e,t){if(e.key==="-"&&!e.ctrlKey&&!e.metaKey){let i=t.getCursor(),n=t.getLine(i.line);if(n.substring(0,i.ch).endsWith("-")){let o=this.isLocaleCompatible(["fr"])?` ${s.MDASH} `:`${s.MDASH}`,p=n.substring(0,i.ch-1)+o+n.substring(i.ch);return t.setLine(i.line,p),t.setCursor({line:i.line,ch:i.ch-1+o.length}),!0}}return!1}getExample(){let e=this.isLocaleCompatible(["fr"])?" \u2014 ":"\u2014";return{before:"P\xE9riode 2020-2024 -- une \xE9poque importante",after:`P\xE9riode 2020${s.NDASH}2024${e}une \xE9poque importante`}}};var A=class extends c{constructor(){super(...arguments);this.id="Hyphen";this.name="C\xE9sures typographiques";this.description="Am\xE9liore les tirets et c\xE9sures (fonctionnalit\xE9 basique)";this.category="punctuation";this.priority=10;this.enabled=!1}fix(e){let t=[{pattern:/^(\s*)-\s*/gm,replacement:this.isLocaleCompatible(["fr"])?`$1${s.MDASH} `:`$1${s.MDASH}`},{pattern:/(\n\s*)-\s+/g,replacement:`$1${s.MDASH} `}];return this.applyMultipleTransforms(e,t)}getExample(){return{before:`- Premier point
- Deuxi\xE8me point
- Dialogue`,after:`${s.MDASH} Premier point
${s.MDASH} Deuxi\xE8me point
${s.MDASH} Dialogue`}}};var R=class extends c{constructor(){super(...arguments);this.id="FrenchNoBreakSpace";this.name="Espaces fran\xE7ais";this.description="Ajoute des espaces ins\xE9cables selon les r\xE8gles fran\xE7aises";this.category="spacing";this.priority=3;this.enabled=!0}fix(e){if(!this.isLocaleCompatible(["fr"]))return e;let t=[{pattern:/\s*([;!?»])/g,replacement:`${s.NO_BREAK_THIN_SPACE}$1`},{pattern:/\s*(:)/g,replacement:`${s.NO_BREAK_SPACE}$1`},{pattern:/(«)\s*/g,replacement:`$1${s.NO_BREAK_THIN_SPACE}`},{pattern:/(\d)\s+(\d{3})/g,replacement:`$1${s.NO_BREAK_THIN_SPACE}$2`}];return this.applyMultipleTransforms(e,t)}handleKeyEvent(e,t){if(!this.isLocaleCompatible(["fr"]))return!1;let i={"!":s.NO_BREAK_THIN_SPACE,"?":s.NO_BREAK_THIN_SPACE,";":s.NO_BREAK_THIN_SPACE,":":s.NO_BREAK_SPACE};if(i[e.key]&&!e.ctrlKey&&!e.metaKey){let n=t.getCursor(),l=t.getLine(n.line),p=l.substring(0,n.ch).replace(/\s+$/,""),u=i[e.key],g=p+u+e.key+l.substring(n.ch);return t.setLine(n.line,g),t.setCursor({line:n.line,ch:p.length+2}),!0}return!1}getExample(){return{before:`Il a dit "Bonjour" et c'est parti.`,after:`Il a dit ${s.LAQUO}${s.NO_BREAK_THIN_SPACE}Bonjour${s.NO_BREAK_THIN_SPACE}${s.RAQUO} et c${s.RSQUO}est parti.`}}};var $=class extends c{constructor(){super(...arguments);this.id="NoSpaceBeforeComma";this.name="Virgules sans espace";this.description="Supprime les espaces avant les virgules et normalise l'espacement";this.category="spacing";this.priority=6}fix(e){let t=[{pattern:/\s+,/g,replacement:","},{pattern:/,\s*/g,replacement:", "},{pattern:/,\s*$/gm,replacement:","},{pattern:/,\s*([)\]}])/g,replacement:",$1"}];return this.applyMultipleTransforms(e,t)}getExample(){return{before:"Pommes , poires,oranges ,bananes",after:"Pommes, poires, oranges, bananes"}}};var _=class extends c{constructor(){super(...arguments);this.id="unit";this.name="Espaces avant unit\xE9s";this.description="Ajoute des espaces ins\xE9cables entre nombres et unit\xE9s (12 h, 50 \u20AC, 25 %)";this.category="spacing";this.priority=7;this.enabled=!0}fix(e){let t=[{pattern:/(\d+)\s*([hms])\b(?![a-zA-Z])/g,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+)\s*(heures?|minutes?|secondes?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+)\s*([€$£¥₹₽])/g,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+)\s*(euros?|dollars?|livres?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*%/g,replacement:`$1${s.NO_BREAK_SPACE}%`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(mg|[cdk]?g|tonnes?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(mm|cm|dm|[dk]?m|km)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(ml|[cdk]?l|litres?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(W|[kmMG]W|kWh?|[kmMG]Wh?)\b/g,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(Hz|[kmMG]Hz)\b/g,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*°([CF]?)\b/g,replacement:`$1${s.NO_BREAK_SPACE}\xB0$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*([kmMGT]?[Bb]|[kmMGT]?o)\b/g,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(octets?|bytes?|bits?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(degrés?|rad|radiants?)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*(km\/h|mph|m\/s)\b/gi,replacement:`$1${s.NO_BREAK_SPACE}$2`}];return this.applyMultipleTransforms(e,t)}isValidContext(e,t){if(!super.isValidContext(e,t))return!1;let i=e.substring(Math.max(0,t-5),t),n=e.substring(t,Math.min(e.length,t+5));return!(i.match(/^\s*#*\s*\d+$/)&&n.match(/^[hH]\d/))}getExample(){return{before:"Temp\xE9rature: 25 \xB0C, vitesse: 120 km/h, taille: 1.8 m, poids: 75 kg, prix: 299 \u20AC",after:`Temp\xE9rature: 25${s.NO_BREAK_SPACE}\xB0C, vitesse: 120${s.NO_BREAK_SPACE}km/h, taille: 1.8${s.NO_BREAK_SPACE}m, poids: 75${s.NO_BREAK_SPACE}kg, prix: 299${s.NO_BREAK_SPACE}\u20AC`}}};var v=class extends c{constructor(){super(...arguments);this.id="Dimension";this.name="Symboles de multiplication";this.description="Convertit x et * entre nombres en symbole \xD7 (12 x 34 \u2192 12\xD734)";this.category="spacing";this.priority=8;this.enabled=!0}fix(e){let t=[{pattern:/(\d+(?:[,.]?\d+)?)\s*[xX]\s*(\d+(?:[,.]?\d+)?)/g,replacement:`$1${s.TIMES}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*\*\s*(\d+(?:[,.]?\d+)?)/g,replacement:`$1${s.TIMES}$2`},{pattern:/(\d+(?:[,.]?\d+)?)\s*[xX]\s*(\d+(?:[,.]?\d+)?)\s*[xX]\s*(\d+(?:[,.]?\d+)?)/g,replacement:`$1${s.TIMES}$2${s.TIMES}$3`},{pattern:/(\d+(?:[,.]?\d+)?)\s*([a-zA-Z]+)\s*[xX]\s*(\d+(?:[,.]?\d+)?)\s*([a-zA-Z]+)?/g,replacement:`$1$2${s.TIMES}$3$4`}];return this.applyMultipleTransforms(e,t)}isValidContext(e,t){if(!super.isValidContext(e,t))return!1;let i=e.substring(Math.max(0,t-10),t),n=e.substring(t,Math.min(e.length,t+10));return!(i.match(/[a-zA-Z]$/)&&n.match(/^[a-zA-Z]/))}getExample(){return{before:"R\xE9solution: 1920 x 1080, format 16 * 9, dimensions 12cm x 34cm x 56cm",after:`R\xE9solution: 1920${s.TIMES}1080, format 16${s.TIMES}9, dimensions 12cm${s.TIMES}34cm${s.TIMES}56cm`}}};var B=class extends c{constructor(){super(...arguments);this.id="SmartQuotes";this.name="Guillemets intelligents";this.description="Convertit les guillemets droits en guillemets typographiques";this.category="quotes";this.priority=4}fix(e){return this.isLocaleCompatible(["fr"])?this.fixFrenchQuotes(e):this.fixEnglishQuotes(e)}fixFrenchQuotes(e){let t=e;this.isGuillemetsEnabled()&&(t=t.replace(/<</g,`${s.LAQUO}${s.NO_BREAK_THIN_SPACE}`),t=t.replace(/>>/g,`${s.NO_BREAK_THIN_SPACE}${s.RAQUO}`));let i=!1;return t=t.replace(/"/g,()=>i?(i=!1,`${s.NO_BREAK_THIN_SPACE}${s.RAQUO}`):(i=!0,`${s.LAQUO}${s.NO_BREAK_THIN_SPACE}`)),t=t.replace(/(«\u202F[^»]*)'([^']*)'([^»]*\u202F»)/g,`$1${s.LDQUO}$2${s.RDQUO}$3`),t=t.replace(/(«\u202F[^»]*)«\u202F([^»]*)\u202F»([^»]*\u202F»)/g,`$1${s.LDQUO}$2${s.RDQUO}$3`),t=t.replace(/'/g,s.RSQUO),t}fixEnglishQuotes(e){let t=e,i=!1;return t=t.replace(/"/g,()=>i?(i=!1,s.RDQUO):(i=!0,s.LDQUO)),t=t.replace(/(\w)'/g,`$1${s.RSQUO}`),t}handleKeyEvent(e,t){return this.isLocaleCompatible(["fr"])&&this.isGuillemetsEnabled()&&(e.key==="<"||e.key===">")?this.handleAngleBracket(e,t):!1}handleAngleBracket(e,t){if(e.ctrlKey||e.metaKey)return!1;let i=t.getCursor(),n=t.getLine(i.line),l=n.substring(0,i.ch);if(e.key==="<"&&l.endsWith("<")){let o=n.substring(0,i.ch-1)+`${s.LAQUO}${s.NO_BREAK_THIN_SPACE}`+n.substring(i.ch);return t.setLine(i.line,o),t.setCursor({line:i.line,ch:i.ch+1}),!0}if(e.key===">"&&l.endsWith(">")){let o=n.substring(0,i.ch-1)+`${s.NO_BREAK_THIN_SPACE}${s.RAQUO}`+n.substring(i.ch);return t.setLine(i.line,o),t.setCursor({line:i.line,ch:i.ch+1}),!0}return!1}getExample(){return this.isLocaleCompatible(["fr"])?{before:`Il a dit "Bonjour" et <<Il m'a dit 'Salut' hier>>.`,after:`Il a dit ${s.LAQUO}${s.NO_BREAK_THIN_SPACE}Bonjour${s.NO_BREAK_THIN_SPACE}${s.RAQUO} et ${s.LAQUO}${s.NO_BREAK_THIN_SPACE}Il m${s.RSQUO}a dit ${s.LDQUO}Salut${s.RDQUO} hier${s.NO_BREAK_THIN_SPACE}${s.RAQUO}.`}:this.isLocaleCompatible(["en"])?{before:`He said "Hello" and it's done.`,after:`He said ${s.LDQUO}Hello${s.RDQUO} and it${s.RSQUO}s done.`}:{before:`Er sagte "Hallo" und es ist 'fertig'.`,after:`Er sagte ${s.LDQUO}Hallo${s.RDQUO} und es ist ${s.RSQUO}fertig${s.RSQUO}.`}}};var F=class extends c{constructor(){super(...arguments);this.id="CurlyQuote";this.name="Apostrophes courbes";this.description="Convertit les apostrophes droites ' en apostrophes typographiques '";this.category="quotes";this.priority=5}fix(e){return this.applyRegexTransform(e,/([a-z])'/gim,`$1${s.RSQUO}`)}handleKeyEvent(e,t){if(e.key==="'"&&!e.ctrlKey&&!e.metaKey){let i=t.getCursor(),n=t.getLine(i.line),l=n.substring(0,i.ch),o=l.slice(-1);if(o&&/[a-zA-Z]/.test(o)){let p=l+s.RSQUO+n.substring(i.ch);return t.setLine(i.line,p),t.setCursor({line:i.line,ch:i.ch+1}),!0}}return!1}getExample(){return{before:"I'm happy, you're great, it's working!",after:`I${s.RSQUO}m happy, you${s.RSQUO}re great, it${s.RSQUO}s working!`}}};var O=class extends c{constructor(){super(...arguments);this.id="Trademark";this.name="Symboles de marques";this.description="Convertit (c) \u2192 \xA9, (r) \u2192 \xAE, (tm) \u2192 \u2122";this.category="symbols";this.priority=9;this.enabled=!0}fix(e){let t=[{pattern:/\(([cC])\)/g,replacement:s.COPY},{pattern:/\(([rR])\)/g,replacement:s.REG},{pattern:/\(([tT][mM])\)/gi,replacement:s.TRADE}];return this.applyMultipleTransforms(e,t)}isValidContext(e,t){if(!super.isValidContext(e,t))return!1;let i=e.substring(Math.max(0,t-20),t),n=e.substring(t,Math.min(e.length,t+20));return!(i.includes("http")||i.includes("www.")||i.includes("/")&&n.includes("/"))}getExample(){return{before:"Microsoft (c) 2025, iPhone (r), Google Search (tm)",after:`Microsoft ${s.COPY} 2025, iPhone ${s.REG}, Google Search ${s.TRADE}`}}};function j(){return[new S,new T,new R,new B,new F,new $,new _,new v,new O,new A]}var N=class{constructor(r){this.fixers=new Map;this.settings=r,this.initializeFixers()}initializeFixers(){j().forEach(e=>{this.fixers.set(e.id,e),e.id in this.settings.fixers&&(e.enabled=this.settings.fixers[e.id]),e.setLocale&&e.setLocale(this.settings.locale),e.setSettings&&e.setSettings(this.settings)})}updateSettings(r){this.settings=r,this.fixers.forEach(e=>{e.id in r.fixers&&(e.enabled=r.fixers[e.id]),e.setLocale&&e.setLocale(r.locale),e.setSettings&&e.setSettings(r)})}getFixers(){return Array.from(this.fixers.values()).sort((r,e)=>r.priority-e.priority)}getEnabledFixers(){return this.getFixers().filter(r=>r.enabled)}getFixersByCategory(r){return this.getFixers().filter(e=>e.category===r)}getFixer(r){return this.fixers.get(r)}processTextWithDetails(r){let e=r,t=this.processText(r),i=e!==t?1:0,n=i>0?["multiple"]:[];return{original:e,corrected:t,correctionsCount:i,fixersUsed:n}}handleKeyEvent(r,e){if(!this.settings.enableRealTimeCorrection||this.isCursorInProtectedZone(e))return!1;let t=this.getEnabledFixers();for(let i of t)if(i.handleKeyEvent)try{if(i.handleKeyEvent(r,e))return!0}catch(n){}return!1}isCursorInProtectedZone(r){let e=r.getCursor(),t=r.getLine(e.line),i=r.getValue(),n=i.split(`
`);if(n.length>0&&n[0].trim()==="---"){let g=-1;for(let d=1;d<n.length;d++)if(n[d].trim()==="---"){g=d;break}if(g!==-1&&e.line<=g)return!0}let l=i.substring(0,r.posToOffset(e)),o=i.substring(r.posToOffset(e));if(l.includes("```")&&o.includes("```")){let g=(l.match(/```/g)||[]).length,d=(o.match(/```/g)||[]).length;if(g%2===1&&d>=1)return!0}let p=[/`[^`]*\|/,/\[\[[^\]]*\|/,/https?:\/\/\S*/,/\/[^\/]*\|/],u=t.substring(0,e.ch);for(let g of p)if(g.test(u))return!0;return!1}toggleFixer(r,e){let t=this.fixers.get(r);return t?(t.enabled=e,this.settings.fixers[r]=e,!0):!1}toggleCategory(r,e){let t=this.getFixersByCategory(r);return t.forEach(i=>{i.enabled=e,this.settings.fixers[i.id]=e}),t.length}resetToDefaults(){this.fixers.forEach(r=>{let e=this.getDefaultEnabledState(r.id);r.enabled=e,this.settings.fixers[r.id]=e})}getDefaultEnabledState(r){let e=["ellipsis","dash","french-spacing","smart-quotes","comma"],t=["ellipsis","dash","smart-quotes","comma"];return this.settings.locale.startsWith("fr")?e.includes(r):t.includes(r)}processText(r){let{maskedText:e,protectedZones:t}=this.maskProtectedContent(r),i=this.processTextContent(e);return this.unmaskProtectedContent(i,t)}processTextContent(r){return this.getEnabledFixers().reduce((t,i)=>{try{return i.fix(t)}catch(n){return t}},r)}maskProtectedContent(r){let e=[],t=r,i=0,n=l=>`__TYPOGRAPHY_PROTECTED_${l.toUpperCase()}_${i++}__`;return t=t.replace(/<[^>]+>/g,l=>{let o=n("html");return e.push({placeholder:o,originalContent:l,type:"html"}),o}),t=t.replace(/\(notes?\s*:\s*"(.+)"\)/g,(l,o)=>{let u=`(note: "${this.processTextContent(o)}")`,g=n("note");return e.push({placeholder:g,originalContent:u,type:"note"}),g}),t=t.replace(/^---\s*\n([\s\S]*?)\n---\s*\n/m,l=>{let o=n("frontmatter");return e.push({placeholder:o,originalContent:l,type:"frontmatter"}),o}),t=t.replace(/```[\s\S]*?```/g,l=>{let o=n("codeblock");return e.push({placeholder:o,originalContent:l,type:"codeblock"}),o}),t=t.replace(/{%\s+(\w+)\s+([\s\S]*?)\s+%}/g,(l,o,p)=>{let u=p;u=u.replace(/caption:\s*"((?:[^"\\]|\\.|"(?:[^"\\]|\\.)*")*)"/g,(D,f)=>`caption: "${this.processTextContent(f)}"`);let g=`{% ${o} ${u} %}`,d=n("shortcode");return e.push({placeholder:d,originalContent:g,type:"shortcode"}),d}),t=t.replace(/\[\[([^\]]+)\]\]/g,l=>{let o=n("wikilink");return e.push({placeholder:o,originalContent:l,type:"wikilink"}),o}),t=t.replace(/https?:\/\/[^\s\])\}]+/g,l=>{let o=n("url");return e.push({placeholder:o,originalContent:l,type:"url"}),o}),t=t.replace(/\/[^\/\s]+\/[gimuy]*/g,l=>{let o=n("regex");return e.push({placeholder:o,originalContent:l,type:"regex"}),o}),t=t.replace(/`[^`]+`/g,l=>{let o=n("inlinecode");return e.push({placeholder:o,originalContent:l,type:"regex"}),o}),t=t.replace(/\[([^\]]*)\]\([^\)]+\)/g,l=>{let o=n("mdlink");return e.push({placeholder:o,originalContent:l,type:"url"}),o}),{maskedText:t,protectedZones:e}}unmaskProtectedContent(r,e){let t=r;return e.forEach(i=>{t=t.replace(i.placeholder,i.originalContent)}),t}};var h=require("obsidian");var y={enableRealTimeCorrection:!0,locale:"fr_FR",highlightEnabled:!1,highlightButton:!0,tabTitleBarButton:!1,guillemetsEnabled:!0,fixers:{Ellipsis:!0,Dash:!0,SmartQuotes:!0,CurlyQuote:!0,FrenchNoBreakSpace:!0,NoSpaceBeforeComma:!0,Unit:!0,Dimension:!0,Hyphen:!1,Trademark:!0}},k={en_GB:["Ellipsis","Dimension","Unit","Dash","SmartQuotes","NoSpaceBeforeComma","CurlyQuote","Hyphen","Trademark"],fr_FR:["Ellipsis","Dimension","Unit","Dash","SmartQuotes","FrenchNoBreakSpace","NoSpaceBeforeComma","CurlyQuote","Hyphen","Trademark"],fr_CA:["Ellipsis","Dimension","Unit","Dash","SmartQuotes","NoSpaceBeforeComma","CurlyQuote","Hyphen","Trademark"],de_DE:["Ellipsis","Dimension","Unit","Dash","SmartQuotes","NoSpaceBeforeComma","CurlyQuote","Hyphen","Trademark"]},I={fr_FR:"\u{1F1EB}\u{1F1F7} Fran\xE7ais (France)",fr_CA:"\u{1F1E8}\u{1F1E6} Fran\xE7ais (Canada)",en_GB:"\u{1F1EC}\u{1F1E7} English (UK)",de_DE:"\u{1F1E9}\u{1F1EA} Deutsch (Deutschland)"};function Y(a){var e,t,i,n,l,o;let r={enableRealTimeCorrection:(e=a.enableRealTimeCorrection)!=null?e:y.enableRealTimeCorrection,locale:(t=a.locale)!=null?t:y.locale,highlightEnabled:(i=a.highlightEnabled)!=null?i:y.highlightEnabled,highlightButton:(n=a.highlightButton)!=null?n:y.highlightButton,tabTitleBarButton:(l=a.tabTitleBarButton)!=null?l:y.tabTitleBarButton,guillemetsEnabled:(o=a.guillemetsEnabled)!=null?o:y.guillemetsEnabled,fixers:{...y.fixers,...a.fixers}};return Object.keys(y.fixers).forEach(p=>{typeof r.fixers[p]!="boolean"&&(r.fixers[p]=y.fixers[p])}),r.locale in k||(r.locale="fr_FR"),r}var X={punctuation:"Ponctuation",spacing:"Espacement",quotes:"Guillemets",symbols:"Symboles"};var w=class extends h.PluginSettingTab{constructor(r,e){super(r,e),this.plugin=e}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Param\xE8tres Typography Fixers"}),r.createEl("p",{text:"Plugin de correction typographique bas\xE9 sur JoliTypo. Corrige automatiquement les erreurs typographiques selon les r\xE8gles fran\xE7aises, anglaises et allemandes.",cls:"setting-item-description"}),this.createGeneralSettings(r),this.createFixerSettings(r),this.createActionsSection(r),this.addCustomStyles(r),this.createHighlightSettings(r)}createGeneralSettings(r){r.createEl("h3",{text:"Configuration g\xE9n\xE9rale"}),new h.Setting(r).setName("Correction en temps r\xE9el").setDesc("Active la correction automatique pendant la frappe").addToggle(i=>i.setValue(this.plugin.settings.enableRealTimeCorrection).onChange(async n=>{this.plugin.settings.enableRealTimeCorrection=n,await this.plugin.saveSettings()})),new h.Setting(r).setName("Langue typographique").setDesc("Choisissez les r\xE8gles typographiques \xE0 appliquer. Change automatiquement les fixers recommand\xE9s.").addDropdown(i=>(Object.entries(I).forEach(([n,l])=>{i.addOption(n,l)}),i.setValue(this.plugin.settings.locale).onChange(async n=>{this.plugin.settings.locale=n,this.updateFixersForLocale(n),await this.plugin.saveSettings()})));let e=Object.values(this.plugin.settings.fixers).filter(Boolean).length,t=Object.keys(this.plugin.settings.fixers).length;r.createEl("p",{text:`${e}/${t} r\xE8gles activ\xE9es pour ${I[this.plugin.settings.locale]}`,cls:"setting-item-description"})}createFixerSettings(r){r.createEl("h3",{text:"R\xE8gles de correction"}),r.createEl("p",{text:"Activez ou d\xE9sactivez les r\xE8gles typographiques selon vos besoins. Les r\xE8gles recommand\xE9es pour votre langue sont activ\xE9es automatiquement.",cls:"setting-item-description"}),new h.Setting(r).setName("Guillemets << >>").setDesc("Active la conversion << et >> en guillemets fran\xE7ais \xAB \xBB").addToggle(t=>t.setValue(this.plugin.settings.guillemetsEnabled).onChange(async i=>{this.plugin.settings.guillemetsEnabled=i,await this.plugin.saveSettings()}));let e=this.plugin.engine.getFixers().reduce((t,i)=>(t[i.category]||(t[i.category]=[]),t[i.category].push(i),t),{});Object.entries(e).forEach(([t,i])=>{r.createEl("h4",{text:X[t]||t,cls:"typography-category-header"}).createEl("button",{text:"Tout basculer",cls:"typography-toggle-category"}).addEventListener("click",async()=>{let p=!i.every(u=>u.enabled);i.forEach(u=>{this.plugin.settings.fixers[u.id]=p}),await this.plugin.saveSettings(),this.display()}),i.forEach(o=>{let p=new h.Setting(r).setName(o.name).setDesc(o.description).addToggle(g=>g.setValue(o.enabled).onChange(async d=>{this.plugin.settings.fixers[o.id]=d,await this.plugin.saveSettings()}));if(this.isFixerRecommendedForCurrentLocale(o.id)){let g=p.nameEl.createEl("span",{text:"Recommand\xE9",cls:"typography-recommended-badge"})}if(o.getExample){let g=o.getExample(),d=p.descEl.createDiv({cls:"typography-example"});d.createDiv({cls:"typography-example-before"}).innerHTML=`<span class="typography-example-label">Avant :</span> <code>${g.before}</code>`,d.createDiv({cls:"typography-example-after"}).innerHTML=`<span class="typography-example-label">Apr\xE8s :</span> <code>${g.after}</code>`}})})}createActionsSection(r){r.createEl("h3",{text:"Actions"}),new h.Setting(r).setName("Restaurer la configuration recommand\xE9e").setDesc(`Active les fixers recommand\xE9s pour ${I[this.plugin.settings.locale]}`).addButton(e=>e.setButtonText("Restaurer").onClick(async()=>{this.updateFixersForLocale(this.plugin.settings.locale),await this.plugin.saveSettings(),new h.Notice("Configuration restaur\xE9e")}))}updateFixersForLocale(r){let e=k[r];e&&(Object.keys(this.plugin.settings.fixers).forEach(t=>{this.plugin.settings.fixers[t]=!1}),e.forEach(t=>{this.plugin.settings.fixers[t]=!0}),this.display())}isFixerRecommendedForCurrentLocale(r){let e=k[this.plugin.settings.locale];return e?e.includes(r):!1}addCustomStyles(r){if(!r.querySelector(".typography-custom-styles")){let e=r.createEl("style",{cls:"typography-custom-styles"});e.textContent=`
                .typography-category-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-top: 24px;
                    margin-bottom: 12px;
                    padding-bottom: 8px;
                    border-bottom: 1px solid var(--background-modifier-border);
                }
                
                .typography-toggle-category {
                    font-size: 0.8em;
                    padding: 4px 8px;
                    border-radius: 4px;
                }
                
                .typography-recommended-badge {
                    display: inline-block;
                    background: var(--color-accent);
                    color: var(--text-on-accent);
                    font-size: 0.7em;
                    padding: 2px 6px;
                    border-radius: 10px;
                    margin-left: 8px;
                    font-weight: 500;
                }
                
                .typography-example {
                    margin-top: 12px;
                    padding: 12px;
                    background: var(--background-primary);
                    border: 1px solid var(--background-modifier-border);
                    border-radius: 6px;
                    font-size: 0.85em;
                    line-height: 1.4;
                }
                
                .typography-example-label {
                    font-weight: 600;
                    color: var(--text-accent);
                    margin-right: 6px;
                }
                
                .typography-example code {
                    background: var(--background-modifier-form-field);
                    color: var(--text-normal);
                    padding: 3px 6px;
                    border-radius: 4px;
                    font-family: var(--font-monospace);
                    font-size: 0.9em;
                    border: 1px solid var(--background-modifier-border-hover);
                    user-select: text;
    pointer-events: auto;
    cursor: text;
                }
                
                .typography-example-before {
                    margin-bottom: 6px;
                }
                
                .typography-example-after {
                    margin-top: 6px;
                }
                
                .typography-test-original,
                .typography-test-corrected {
                    background: var(--background-secondary);
                    padding: 12px;
                    border-radius: 4px;
                    margin: 8px 0;
                    font-family: var(--font-monospace);
                    font-size: 0.9em;
                    white-space: pre-wrap;
                }
                
                .typography-no-changes {
                    color: var(--text-warning);
                    font-style: italic;
                    margin-top: 12px;
                }
            `}}createHighlightSettings(r){let e=r.createEl("p",{text:"Affichage des caract\xE8res invisibles"});e.style.fontWeight="bold",e.style.marginTop="3em",new h.Setting(r).setName("Activer l'affichage des caract\xE8res invisibles").addToggle(t=>t.setValue(this.plugin.settings.highlightEnabled).onChange(async i=>{this.plugin.settings.highlightEnabled=i,await this.plugin.saveSettings()}))}};var L=class extends m.Plugin{constructor(){super(...arguments);this.statusBarButton=null;this.tabTitleBarButton=null;this.decorationExtension=null}async onload(){try{await this.loadSettings(),this.engine=new N(this.settings),this.decorationExtension=q(this.settings),this.registerEditorExtension(this.decorationExtension),this.updateInvisibleCharsDisplay(),this.settings.highlightButton&&(this.statusBarButton=G(this,this.settings.highlightEnabled,this.toggleHighlight.bind(this))),this.settings.tabTitleBarButton&&(this.tabTitleBarButton=V(this,this.settings.highlightEnabled,()=>this.toggleHighlight())),this.addCommands(),this.registerEditorMenuItems(),this.registerKeyboardHandlers(),this.addSettingTab(new w(this.app,this)),new m.Notice("Typography Fixers charg\xE9 avec succ\xE8s!",3e3)}catch(e){new m.Notice("Erreur lors du chargement du plugin",5e3)}}onunload(){z(this.statusBarButton),W(this.tabTitleBarButton)}async loadSettings(){let e=await this.loadData();this.settings=Y(e||{})}async saveSettings(){await this.saveData(this.settings),this.engine&&this.engine.updateSettings(this.settings),this.updateInvisibleCharsDisplay()}registerEditorMenuItems(){this.registerEvent(this.app.workspace.on("editor-menu",(e,t,i)=>{e.addSeparator(),e.addItem(n=>{n.setTitle("\u2014 Ins\xE9rer caract\xE8res typographiques \u2014").setIcon("type").setDisabled(!0)}),e.addItem(n=>{n.setTitle("Ins\xE9rer : Espace ins\xE9cable").setIcon("space").onClick(()=>{this.insertSpecialChar(t,s.NO_BREAK_SPACE)})}),e.addItem(n=>{n.setTitle("Ins\xE9rer : Espace fine ins\xE9cable").setIcon("minus").onClick(()=>{this.insertSpecialChar(t,s.NO_BREAK_THIN_SPACE)})}),e.addItem(n=>{n.setTitle("Ins\xE9rer : Guillemet ouvrant (\u201C)").setIcon("quote-glyph").onClick(()=>{this.insertSpecialChar(t,s.LDQUO)})}),e.addItem(n=>{n.setTitle("Ins\xE9rer : Guillemet fermant (\u201D)").setIcon("quote-glyph").onClick(()=>{this.insertSpecialChar(t,s.RDQUO)})}),this.settings.guillemetsEnabled&&this.settings.locale.startsWith("fr")&&(e.addItem(n=>{n.setTitle("Ins\xE9rer : Guillemet fran\xE7ais \xAB ").setIcon("quote-glyph").onClick(()=>{this.insertSpecialChar(t,`${s.LAQUO}${s.NO_BREAK_THIN_SPACE}`)})}),e.addItem(n=>{n.setTitle("Ins\xE9rer : Guillemet fran\xE7ais \xBB").setIcon("quote-glyph").onClick(()=>{this.insertSpecialChar(t,`${s.NO_BREAK_THIN_SPACE}${s.RAQUO}`)})}))}))}addCommands(){this.addCommand({id:"fix-selection",name:"Corriger la s\xE9lection",icon:"type",editorCallback:e=>{this.correctSelection(e)}}),this.addCommand({id:"fix-entire-note",name:"Corriger toute la note",icon:"whole-word",editorCallback:e=>{this.correctEntireNote(e)}}),this.addCommand({id:"toggle-realtime",name:"Basculer correction temps r\xE9el",icon:"zap",callback:async()=>{await this.toggleRealTimeCorrection()}}),this.addCommand({id:"toggle-highlight",name:"Afficher/Masquer les caract\xE8res invisibles",callback:()=>{this.toggleHighlight()}}),this.addCommand({id:"insert-non-breaking-space",name:"Ins\xE9rer espace ins\xE9cable",icon:"space",editorCallback:e=>{this.insertSpecialSpace(e,s.NO_BREAK_SPACE)},hotkeys:[{modifiers:["Ctrl","Shift"],key:" "}]}),this.addCommand({id:"insert-thin-non-breaking-space",name:"Ins\xE9rer espace fine ins\xE9cable",icon:"minus",editorCallback:e=>{this.insertSpecialSpace(e,s.NO_BREAK_THIN_SPACE)},hotkeys:[{modifiers:["Ctrl","Alt","Shift"],key:" "}]}),this.addCommand({id:"insert-left-double-quote",name:"Ins\xE9rer guillemet ouvrant anglais (\u201C)",icon:"quote-glyph",editorCallback:e=>{this.insertSpecialChar(e,s.LDQUO)},hotkeys:[{modifiers:["Ctrl"],key:"7"}]}),this.addCommand({id:"insert-right-double-quote",name:"Ins\xE9rer guillemet fermant anglais (\u201D)",icon:"quote-glyph",editorCallback:e=>{this.insertSpecialChar(e,s.RDQUO)},hotkeys:[{modifiers:["Ctrl"],key:"8"}]})}insertSpecialChar(e,t){let i=e.getCursor();e.replaceRange(t,i),e.setCursor({line:i.line,ch:i.ch+1})}insertSpecialSpace(e,t){let i=e.getCursor();e.replaceRange(t,i),e.setCursor({line:i.line,ch:i.ch+1})}correctSelection(e){let t=e.getSelection();if(t){let i=this.engine.processTextWithDetails(t);e.replaceSelection(i.corrected),this.showCorrectionNotice(i.correctionsCount,i.fixersUsed)}else this.correctEntireNote(e)}correctEntireNote(e){let t=e.getValue(),i=this.engine.processTextWithDetails(t);i.corrected!==t?(e.setValue(i.corrected),this.showCorrectionNotice(i.correctionsCount,i.fixersUsed)):new m.Notice("Aucune correction n\xE9cessaire",2e3)}async toggleRealTimeCorrection(){this.settings.enableRealTimeCorrection=!this.settings.enableRealTimeCorrection,await this.saveSettings();let e=this.settings.enableRealTimeCorrection?"activ\xE9e":"d\xE9sactiv\xE9e";new m.Notice(`Correction temps r\xE9el ${e}`,3e3)}showCorrectionNotice(e,t){if(e===0){new m.Notice("Aucune correction appliqu\xE9e",2e3);return}let i=e===1?"1 correction appliqu\xE9e":`${e} corrections appliqu\xE9es`;new m.Notice(i,3e3)}registerKeyboardHandlers(){this.registerDomEvent(document,"keydown",e=>{this.handleKeyDown(e)})}handleKeyDown(e){let t=this.app.workspace.getActiveViewOfType(m.MarkdownView);if(!t||t.getMode()!=="source")return;let i=t.editor;this.engine.handleKeyEvent(e,i)&&e.preventDefault()}getEngine(){return this.engine}async applyCorrections(e){return this.engine.processText(e)}getAvailableFixers(){return this.engine.getFixers().map(e=>e.id)}updateInvisibleCharsDisplay(){this.settings.highlightEnabled?document.body.addClass("typography-show-invisible"):document.body.removeClass("typography-show-invisible")}async toggleHighlight(){this.settings.highlightEnabled=!this.settings.highlightEnabled,this.updateInvisibleCharsDisplay(),await this.saveSettings();let e=this.settings.highlightEnabled?"activ\xE9":"d\xE9sactiv\xE9";new m.Notice(`Affichage des caract\xE8res invisibles ${e}`,3e3),M(this.statusBarButton,this.settings.highlightEnabled),K(this.tabTitleBarButton,this.settings.highlightEnabled)}};
